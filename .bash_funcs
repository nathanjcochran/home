#!/bin/bash

dev_dir="$HOME/dev/popsql"

dev () {
    cd "${dev_dir}/${1}"
    clear
}

_dev () {
    local cur="${COMP_WORDS[COMP_CWORD]}"
    if [[ $cur = /* ]] || [[ $cur = ~* ]]; then
        return
    fi
    cd "${dev_dir}"
    compopt -o filenames 2>/dev/null
    COMPREPLY=( $(compgen -d -- "$cur"))
}

complete -F _dev dev

pop_dir="$HOME/dev/popsql/popsql"

pop () {
    cd "${pop_dir}/${1}"
    clear
}

_pop () {
    local cur="${COMP_WORDS[COMP_CWORD]}"
    if [[ $cur = /* ]] || [[ $cur = ~* ]]; then
        return
    fi
    cd "${pop_dir}"
    compopt -o filenames 2>/dev/null
    COMPREPLY=( $(compgen -d -- "packages/popsql-$cur"))
}

complete -F _pop pop

ent() {
    (cd "$HOME/src/github.com/nicheinc/development" && exec docker-compose run --rm postgres psql postgres://postgres:prowl3r@postgres:5432/entity -t -c "SELECT name, url, type, genus FROM entity WHERE uuid='$1'")
}

psql_local() {
    (cd "$HOME/src/github.com/nicheinc/development" && \
        docker-compose run --rm \
            --volume="${HOME}/.pgpass:/home/.pgpass:ro" \
            -e "PGPASSFILE=//home/.pgpass" \
            postgres psql "postgres://postgres@postgres/$1" "${@:2}")
}

psql_devvm() {
    (cd "$HOME/src/github.com/nicheinc/development" && \
        docker-compose run --rm \
            --volume="${HOME}/.pgpass:/home/.pgpass:ro" \
            -e "PGPASSFILE=//home/.pgpass" \
            postgres psql "postgres://postgres@devvm-postgres/$1" "${@:2}")
}
